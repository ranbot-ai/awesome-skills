{
  "id": "antigravity-moodle-external-api-development",
  "name": "moodle-external-api-development",
  "slug": "moodle-external-api-development",
  "description": "Create custom external web service APIs for Moodle LMS. Use when implementing web services for course management, user tracking, quiz operations, or custom plugin functionality. Covers parameter validation, database operations, error handling, service registration, and Moodle coding standards.",
  "category": "Document Processing",
  "source": "antigravity",
  "repoUrl": "https://github.com/sickn33/antigravity-awesome-skills",
  "skillUrl": "https://github.com/sickn33/antigravity-awesome-skills/tree/main/skills/moodle-external-api-development",
  "content": "\n# Moodle External API Development\n\nThis skill guides you through creating custom external web service APIs for Moodle LMS, following Moodle's external API framework and coding standards.\n\n## When to Use This Skill\n\n- Creating custom web services for Moodle plugins\n- Implementing REST/AJAX endpoints for course management\n- Building APIs for quiz operations, user tracking, or reporting\n- Exposing Moodle functionality to external applications\n- Developing mobile app backends using Moodle\n\n## Core Architecture Pattern\n\nMoodle external APIs follow a strict three-method pattern:\n\n1. **`execute_parameters()`** - Defines input parameter structure\n2. **`execute()`** - Contains business logic\n3. **`execute_returns()`** - Defines return structure\n\n## Step-by-Step Implementation\n\n### Step 1: Create the External API Class File\n\n**Location**: `/local/yourplugin/classes/external/your_api_name.php`\n\n```php\n<?php\nnamespace local_yourplugin\\external;\n\ndefined('MOODLE_INTERNAL') || die();\nrequire_once(\"$CFG->libdir/externallib.php\");\n\nuse external_api;\nuse external_function_parameters;\nuse external_single_structure;\nuse external_value;\n\nclass your_api_name extends external_api {\n    \n    // Three required methods will go here\n    \n}\n```\n\n**Key Points**:\n- Class must extend `external_api`\n- Namespace follows: `local_pluginname\\external` or `mod_modname\\external`\n- Include the security check: `defined('MOODLE_INTERNAL') || die();`\n- Require externallib.php for base classes\n\n### Step 2: Define Input Parameters\n\n```php\npublic static function execute_parameters() {\n    return new external_function_parameters([\n        'userid' => new external_value(PARAM_INT, 'User ID', VALUE_REQUIRED),\n        'courseid' => new external_value(PARAM_INT, 'Course ID', VALUE_REQUIRED),\n        'options' => new external_single_structure([\n            'includedetails' => new external_value(PARAM_BOOL, 'Include details', VALUE_DEFAULT, false),\n            'limit' => new external_value(PARAM_INT, 'Result limit', VALUE_DEFAULT, 10)\n        ], 'Options', VALUE_OPTIONAL)\n    ]);\n}\n```\n\n**Common Parameter Types**:\n- `PARAM_INT` - Integers\n- `PARAM_TEXT` - Plain text (HTML stripped)\n- `PARAM_RAW` - Raw text (no cleaning)\n- `PARAM_BOOL` - Boolean values\n- `PARAM_FLOAT` - Floating point numbers\n- `PARAM_ALPHANUMEXT` - Alphanumeric with extended chars\n\n**Structures**:\n- `external_value` - Single value\n- `external_single_structure` - Object with named fields\n- `external_multiple_structure` - Array of items\n\n**Value Flags**:\n- `VALUE_REQUIRED` - Parameter must be provided\n- `VALUE_OPTIONAL` - Parameter is optional\n- `VALUE_DEFAULT, defaultvalue` - Optional with default\n\n### Step 3: Implement Business Logic\n\n```php\npublic static function execute($userid, $courseid, $options = []) {\n    global $DB, $USER;\n\n    // 1. Validate parameters\n    $params = self::validate_parameters(self::execute_parameters(), [\n        'userid' => $userid,\n        'courseid' => $courseid,\n        'options' => $options\n    ]);\n\n    // 2. Check permissions/capabilities\n    $context = \\context_course::instance($params['courseid']);\n    self::validate_context($context);\n    require_capability('moodle/course:view', $context);\n\n    // 3. Verify user access\n    if ($params['userid'] != $USER->id) {\n        require_capability('moodle/course:viewhiddenactivities', $context);\n    }\n\n    // 4. Database operations\n    $sql = \"SELECT id, name, timecreated\n            FROM {your_table}\n            WHERE userid = :userid\n              AND courseid = :courseid\n            LIMIT :limit\";\n    \n    $records = $DB->get_records_sql($sql, [\n        'userid' => $params['userid'],\n        'courseid' => $params['courseid'],\n        'limit' => $params['options']['limit']\n    ]);\n\n    // 5. Process and return data\n    $results = [];\n    foreach ($records as $record) {\n        $results[] = [\n            'id' => $record->id,\n            'name' => $record->name,\n            'timestamp' => $record->timecreated\n        ];\n    }\n\n    return [\n        'items' => $results,\n        'count' => count($results)\n    ];\n}\n```\n\n**Critical Steps**:\n1. **Always validate parameters** using `validate_parameters()`\n2. **Check context** using `validate_context()`\n3. **Verify capabilities** using `require_capability()`\n4. **Use parameterized queries** to prevent SQL injection\n5. **Return structured data** matching return definition\n\n### Step 4: Define Return Structure\n\n```php\npublic static function execute_returns() {\n    return new external_single_structure([\n        'items' => new external_multiple_structure(\n            new external_single_structure([\n                'id' => new external_value(PARAM_INT, 'Item ID'),\n                'name' => new external_value(PARAM_TEXT, 'Item name'),\n                'timestamp' => new external_value(PARAM_INT, 'Creation time')\n            ])\n        ),\n        'count' => new external_value(PARAM_INT, 'Total items')\n    ]);\n}\n```\n\n**Return Structure Rules**:\n- Must match exactly what `execute()` re",
  "tags": [
    "javascript",
    "api",
    "ai",
    "document",
    "security"
  ],
  "useCases": [
    "Creating custom web services for Moodle plugins",
    "Implementing REST/AJAX endpoints for course management",
    "Building APIs for quiz operations, user tracking, or reporting",
    "Exposing Moodle functionality to external applications",
    "Developing mobile app backends using Moodle"
  ],
  "scrapedAt": "2026-01-26T13:19:42.849Z"
}