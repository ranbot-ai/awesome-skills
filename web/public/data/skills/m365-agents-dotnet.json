{
  "id": "antigravity-m365-agents-dotnet",
  "name": "m365-agents-dotnet",
  "slug": "m365-agents-dotnet",
  "description": "Microsoft 365 Agents SDK for .NET. Build multichannel agents for Teams/M365/Copilot Studio with ASP.NET Core hosting, AgentApplication routing, and MSAL-based auth. Triggers: \"Microsoft 365 Agents SDK\", \"Microsoft.Agents\", \"AddAgentApplicationOptions\", \"AgentApplication\", \"AddAgentAspNetAuthenticati",
  "category": "AI & Agents",
  "source": "antigravity",
  "repoUrl": "https://github.com/sickn33/antigravity-awesome-skills",
  "skillUrl": "https://github.com/sickn33/antigravity-awesome-skills/tree/main/skills/m365-agents-dotnet",
  "content": "\n# Microsoft 365 Agents SDK (.NET)\n\n## Overview\nBuild enterprise agents for Microsoft 365, Teams, and Copilot Studio using the Microsoft.Agents SDK with ASP.NET Core hosting, agent routing, and MSAL-based authentication.\n\n## Before implementation\n- Use the microsoft-docs MCP to verify the latest APIs for AddAgent, AgentApplication, and authentication options.\n- Confirm package versions in NuGet for the Microsoft.Agents.* packages you plan to use.\n\n## Installation\n\n```bash\ndotnet add package Microsoft.Agents.Hosting.AspNetCore\ndotnet add package Microsoft.Agents.Authentication.Msal\ndotnet add package Microsoft.Agents.Storage\ndotnet add package Microsoft.Agents.CopilotStudio.Client\ndotnet add package Microsoft.Identity.Client.Extensions.Msal\n```\n\n## Configuration (appsettings.json)\n\n```json\n{\n  \"TokenValidation\": {\n    \"Enabled\": true,\n    \"Audiences\": [\n      \"{{ClientId}}\"\n    ],\n    \"TenantId\": \"{{TenantId}}\"\n  },\n  \"AgentApplication\": {\n    \"StartTypingTimer\": false,\n    \"RemoveRecipientMention\": false,\n    \"NormalizeMentions\": false\n  },\n  \"Connections\": {\n    \"ServiceConnection\": {\n      \"Settings\": {\n        \"AuthType\": \"ClientSecret\",\n        \"ClientId\": \"{{ClientId}}\",\n        \"ClientSecret\": \"{{ClientSecret}}\",\n        \"AuthorityEndpoint\": \"https://login.microsoftonline.com/{{TenantId}}\",\n        \"Scopes\": [\n          \"https://api.botframework.com/.default\"\n        ]\n      }\n    }\n  },\n  \"ConnectionsMap\": [\n    {\n      \"ServiceUrl\": \"*\",\n      \"Connection\": \"ServiceConnection\"\n    }\n  ],\n  \"CopilotStudioClientSettings\": {\n    \"DirectConnectUrl\": \"\",\n    \"EnvironmentId\": \"\",\n    \"SchemaName\": \"\",\n    \"TenantId\": \"\",\n    \"AppClientId\": \"\",\n    \"AppClientSecret\": \"\"\n  }\n}\n```\n\n## Core Workflow: ASP.NET Core agent host\n\n```csharp\nusing Microsoft.Agents.Builder;\nusing Microsoft.Agents.Hosting.AspNetCore;\nusing Microsoft.Agents.Storage;\nusing Microsoft.AspNetCore.Builder;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.Extensions.DependencyInjection;\nusing Microsoft.Extensions.Hosting;\n\nvar builder = WebApplication.CreateBuilder(args);\n\nbuilder.Services.AddHttpClient();\nbuilder.AddAgentApplicationOptions();\nbuilder.AddAgent<MyAgent>();\nbuilder.Services.AddSingleton<IStorage, MemoryStorage>();\n\nbuilder.Services.AddControllers();\nbuilder.Services.AddAgentAspNetAuthentication(builder.Configuration);\n\nWebApplication app = builder.Build();\n\napp.UseAuthentication();\napp.UseAuthorization();\n\napp.MapGet(\"/\", () => \"Microsoft Agents SDK Sample\");\n\nvar incomingRoute = app.MapPost(\"/api/messages\",\n    async (HttpRequest request, HttpResponse response, IAgentHttpAdapter adapter, IAgent agent, CancellationToken ct) =>\n    {\n        await adapter.ProcessAsync(request, response, agent, ct);\n    });\n\nif (!app.Environment.IsDevelopment())\n{\n    incomingRoute.RequireAuthorization();\n}\nelse\n{\n    app.Urls.Add(\"http://localhost:3978\");\n}\n\napp.Run();\n```\n\n## AgentApplication routing\n\n```csharp\nusing Microsoft.Agents.Builder;\nusing Microsoft.Agents.Builder.App;\nusing Microsoft.Agents.Builder.State;\nusing Microsoft.Agents.Core.Models;\nusing System;\nusing System.Threading;\nusing System.Threading.Tasks;\n\npublic sealed class MyAgent : AgentApplication\n{\n    public MyAgent(AgentApplicationOptions options) : base(options)\n    {\n        OnConversationUpdate(ConversationUpdateEvents.MembersAdded, WelcomeAsync);\n        OnActivity(ActivityTypes.Message, OnMessageAsync, rank: RouteRank.Last);\n        OnTurnError(OnTurnErrorAsync);\n    }\n\n    private static async Task WelcomeAsync(ITurnContext turnContext, ITurnState turnState, CancellationToken ct)\n    {\n        foreach (ChannelAccount member in turnContext.Activity.MembersAdded)\n        {\n            if (member.Id != turnContext.Activity.Recipient.Id)\n            {\n                await turnContext.SendActivityAsync(\n                    MessageFactory.Text(\"Welcome to the agent.\"),\n                    ct);\n            }\n        }\n    }\n\n    private static async Task OnMessageAsync(ITurnContext turnContext, ITurnState turnState, CancellationToken ct)\n    {\n        await turnContext.SendActivityAsync(\n            MessageFactory.Text($\"You said: {turnContext.Activity.Text}\"),\n            ct);\n    }\n\n    private static async Task OnTurnErrorAsync(\n        ITurnContext turnContext,\n        ITurnState turnState,\n        Exception exception,\n        CancellationToken ct)\n    {\n        await turnState.Conversation.DeleteStateAsync(turnContext, ct);\n\n        var endOfConversation = Activity.CreateEndOfConversationActivity();\n        endOfConversation.Code = EndOfConversationCodes.Error;\n        endOfConversation.Text = exception.Message;\n        await turnContext.SendActivityAsync(endOfConversation, ct);\n    }\n}\n```\n\n## Copilot Studio direct-to-engine client\n\n### DelegatingHandler for token acquisition (interactive flow)\n\n```csharp\nusing System.Net.Http.Headers;\nusing Microsoft.Agents.CopilotStudio.Client;\nusing Microsoft.Identity.Client;\n\ninternal sealed class AddTokenHandler : DelegatingHand",
  "tags": [
    "api",
    "mcp",
    "ai",
    "agent",
    "workflow",
    "azure",
    "rag",
    "cro"
  ],
  "useCases": [],
  "scrapedAt": "2026-02-12T07:17:58.288Z"
}