{
  "id": "antigravity-hosted-agents-v2-py",
  "name": "hosted-agents-v2-py",
  "slug": "hosted-agents-v2-py",
  "description": "Build hosted agents using Azure AI Projects SDK with ImageBasedHostedAgentDefinition.\nUse when creating container-based agents that run custom code in Azure AI Foundry.\nTriggers: \"ImageBasedHostedAgentDefinition\", \"hosted agent\", \"container agent\", \n\"create_version\", \"ProtocolVersionRecord\", \"AgentP",
  "category": "AI & Agents",
  "source": "antigravity",
  "repoUrl": "https://github.com/sickn33/antigravity-awesome-skills",
  "skillUrl": "https://github.com/sickn33/antigravity-awesome-skills/tree/main/skills/hosted-agents-v2-py",
  "content": "\n# Azure AI Hosted Agents (Python)\n\nBuild container-based hosted agents using `ImageBasedHostedAgentDefinition` from the Azure AI Projects SDK.\n\n## Installation\n\n```bash\npip install azure-ai-projects>=2.0.0b3 azure-identity\n```\n\n**Minimum SDK Version:** `2.0.0b3` or later required for hosted agent support.\n\n## Environment Variables\n\n```bash\nAZURE_AI_PROJECT_ENDPOINT=https://<resource>.services.ai.azure.com/api/projects/<project>\n```\n\n## Prerequisites\n\nBefore creating hosted agents:\n\n1. **Container Image** - Build and push to Azure Container Registry (ACR)\n2. **ACR Pull Permissions** - Grant your project's managed identity `AcrPull` role on the ACR\n3. **Capability Host** - Account-level capability host with `enablePublicHostingEnvironment=true`\n4. **SDK Version** - Ensure `azure-ai-projects>=2.0.0b3`\n\n## Authentication\n\nAlways use `DefaultAzureCredential`:\n\n```python\nfrom azure.identity import DefaultAzureCredential\nfrom azure.ai.projects import AIProjectClient\n\ncredential = DefaultAzureCredential()\nclient = AIProjectClient(\n    endpoint=os.environ[\"AZURE_AI_PROJECT_ENDPOINT\"],\n    credential=credential\n)\n```\n\n## Core Workflow\n\n### 1. Imports\n\n```python\nimport os\nfrom azure.identity import DefaultAzureCredential\nfrom azure.ai.projects import AIProjectClient\nfrom azure.ai.projects.models import (\n    ImageBasedHostedAgentDefinition,\n    ProtocolVersionRecord,\n    AgentProtocol,\n)\n```\n\n### 2. Create Hosted Agent\n\n```python\nclient = AIProjectClient(\n    endpoint=os.environ[\"AZURE_AI_PROJECT_ENDPOINT\"],\n    credential=DefaultAzureCredential()\n)\n\nagent = client.agents.create_version(\n    agent_name=\"my-hosted-agent\",\n    definition=ImageBasedHostedAgentDefinition(\n        container_protocol_versions=[\n            ProtocolVersionRecord(protocol=AgentProtocol.RESPONSES, version=\"v1\")\n        ],\n        cpu=\"1\",\n        memory=\"2Gi\",\n        image=\"myregistry.azurecr.io/my-agent:latest\",\n        tools=[{\"type\": \"code_interpreter\"}],\n        environment_variables={\n            \"AZURE_AI_PROJECT_ENDPOINT\": os.environ[\"AZURE_AI_PROJECT_ENDPOINT\"],\n            \"MODEL_NAME\": \"gpt-4o-mini\"\n        }\n    )\n)\n\nprint(f\"Created agent: {agent.name} (version: {agent.version})\")\n```\n\n### 3. List Agent Versions\n\n```python\nversions = client.agents.list_versions(agent_name=\"my-hosted-agent\")\nfor version in versions:\n    print(f\"Version: {version.version}, State: {version.state}\")\n```\n\n### 4. Delete Agent Version\n\n```python\nclient.agents.delete_version(\n    agent_name=\"my-hosted-agent\",\n    version=agent.version\n)\n```\n\n## ImageBasedHostedAgentDefinition Parameters\n\n| Parameter | Type | Required | Description |\n|-----------|------|----------|-------------|\n| `container_protocol_versions` | `list[ProtocolVersionRecord]` | Yes | Protocol versions the agent supports |\n| `image` | `str` | Yes | Full container image path (registry/image:tag) |\n| `cpu` | `str` | No | CPU allocation (e.g., \"1\", \"2\") |\n| `memory` | `str` | No | Memory allocation (e.g., \"2Gi\", \"4Gi\") |\n| `tools` | `list[dict]` | No | Tools available to the agent |\n| `environment_variables` | `dict[str, str]` | No | Environment variables for the container |\n\n## Protocol Versions\n\nThe `container_protocol_versions` parameter specifies which protocols your agent supports:\n\n```python\nfrom azure.ai.projects.models import ProtocolVersionRecord, AgentProtocol\n\n# RESPONSES protocol - standard agent responses\ncontainer_protocol_versions=[\n    ProtocolVersionRecord(protocol=AgentProtocol.RESPONSES, version=\"v1\")\n]\n```\n\n**Available Protocols:**\n| Protocol | Description |\n|----------|-------------|\n| `AgentProtocol.RESPONSES` | Standard response protocol for agent interactions |\n\n## Resource Allocation\n\nSpecify CPU and memory for your container:\n\n```python\ndefinition=ImageBasedHostedAgentDefinition(\n    container_protocol_versions=[...],\n    image=\"myregistry.azurecr.io/my-agent:latest\",\n    cpu=\"2\",      # 2 CPU cores\n    memory=\"4Gi\"  # 4 GiB memory\n)\n```\n\n**Resource Limits:**\n| Resource | Min | Max | Default |\n|----------|-----|-----|---------|\n| CPU | 0.5 | 4 | 1 |\n| Memory | 1Gi | 8Gi | 2Gi |\n\n## Tools Configuration\n\nAdd tools to your hosted agent:\n\n### Code Interpreter\n\n```python\ntools=[{\"type\": \"code_interpreter\"}]\n```\n\n### MCP Tools\n\n```python\ntools=[\n    {\"type\": \"code_interpreter\"},\n    {\n        \"type\": \"mcp\",\n        \"server_label\": \"my-mcp-server\",\n        \"server_url\": \"https://my-mcp-server.example.com\"\n    }\n]\n```\n\n### Multiple Tools\n\n```python\ntools=[\n    {\"type\": \"code_interpreter\"},\n    {\"type\": \"file_search\"},\n    {\n        \"type\": \"mcp\",\n        \"server_label\": \"custom-tool\",\n        \"server_url\": \"https://custom-tool.example.com\"\n    }\n]\n```\n\n## Environment Variables\n\nPass configuration to your container:\n\n```python\nenvironment_variables={\n    \"AZURE_AI_PROJECT_ENDPOINT\": os.environ[\"AZURE_AI_PROJECT_ENDPOINT\"],\n    \"MODEL_NAME\": \"gpt-4o-mini\",\n    \"LOG_LEVEL\": \"INFO\",\n    \"CUSTOM_CONFIG\": \"value\"\n}\n```\n\n**Best Practice:** Never hardcode secrets. Use environment vari",
  "tags": [
    "python",
    "api",
    "mcp",
    "ai",
    "agent",
    "gpt",
    "workflow",
    "document",
    "image",
    "azure"
  ],
  "useCases": [],
  "scrapedAt": "2026-02-14T07:05:41.893Z"
}